<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>NFLIX</title>
  <meta name="description" content="NFLIX √© uma plataforma digital dedicada a oferecer uma vasta sele√ß√£o de filmes, s√©ries e animes para todos os p√∫blicos.">
  <meta name="robots" content="index, follow" />
  <meta name="theme-color" content="#E50914">
  <link rel="icon" href="/icons/icon-512.png">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <link rel="icon" type="image/png" href="/icons/icon-512.png" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700;900&display=swap" rel="stylesheet">
  <!-- Google Analytics  colocar teu c√≥digo G-->
  <script async src="https://www.googletagmanager.com/gtag/js?id=WMF4PCY1EJ"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-WMF4PCY1EJ');
  </script>
  <link rel="stylesheet" href="zy.css">
</head>
<body>
<!-- Tela bloqueada + Bot√£o Monetag Central -->
<style>
  /* Fundo que trava tudo */
  #screen-locker {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background: rgba(0,0,0,0.75);
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
    z-index: 999999;
    display: flex;
    justify-content: center;
    align-items: center;
  }

  /* Bot√£o principal */
  #floating-center-btn {
    background: linear-gradient(45deg, #ff5722, #ff8a00);
    color: #fff;
    padding: 15px 24px;
    font-size: 20px;
    font-weight: bold;
    border-radius: 50px;
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    gap: 10px;
    box-shadow: 0 5px 25px rgba(0,0,0,0.35);
    font-family: Arial, sans-serif;
    transition: transform 0.25s ease;
    animation: pulseCenter 1.8s infinite ease-in-out;
  }

  #floating-center-btn:hover {
    transform: scale(1.12);
  }

  #floating-center-btn img {
    width: 60px;
    height: 60px;
    object-fit: cover;
    border-radius: 50%;
    border: 2px solid #fff;
  }

  @keyframes pulseCenter {
    0% { transform: scale(1); }
    50% { transform: scale(1.10); }
    100% { transform: scale(1); }
  }
</style>

<div id="screen-locker">
  <a href="https://www.effectivegatecpm.com/kj1ep81t9?key=653c88e561a5320c41fa5a9588d10386"
     id="floating-center-btn"
     target="_blank"
     rel="noopener noreferrer">

      <img src="https://via.placeholder.com/300x300.jpg?text=VEJA+FILME" alt="VEJA FILME">
      PARA VER FILME ‚Äî CLIQUE AQUI üòéüçø
  </a>
</div>


  <!-- Header Netflix -->
  <header id="main-header">
    <a href="?page=home" class="logo">NFLIX</a>
    <div class="header-right">
      <div class="search-container">
        <input type="text" class="search-input" placeholder="Pesquisar..." id="header-search-input">
      </div>
    </div>
  </header>

  <div class="page" data-page="home">
    <!-- Hero Section Netflix -->
    <section class="hero" id="hero">
      <div class="hero-content">
        <h1 class="hero-title" id="hero-title">Carregando...</h1>
        <p class="hero-desc" id="hero-desc"></p>
        <div class="hero-actions">
          <button class="hero-btn btn-play" id="hero-play">
            <i class="fas fa-play"></i> Reproduzir
          </button>
          <button class="hero-btn btn-info" id="hero-info">
            <i class="fas fa-info-circle"></i> Mais Informa√ß√µes
          </button>
        </div>
      </div>
    </section>

    <!-- Categories Netflix -->
    <section class="categories">
      <div id="categories-container">
        <!-- Categorias ser√£o inseridas aqui via JavaScript -->
      </div>
    </section>
  </div>

  <div class="page" data-page="search">
    <div class="search-page">
      <div class="search-header">
        <h1>Pesquisar</h1>
        <div class="search-input-container">
          <input type="text" class="search-input-large" placeholder="Pesquisar filmes, s√©ries..." id="search-input" value="">
          <div class="search-icon">
            <i class="fas fa-search"></i>
          </div>
        </div>
      </div>
      
      <div class="grid-view" id="search-results">
        <!-- Resultados da pesquisa ser√£o carregados via JavaScript -->
      </div>
      <div class="loading" id="search-loading" style="display: none;">
        <div class="spinner"></div>
      </div>
      <div class="pagination" id="search-pagination">
        <!-- Pagina√ß√£o ser√° inserida aqui via JavaScript -->
      </div>
    </div>
  </div>

  <div class="page" data-page="favorites">
    <div class="search-page">
      <div class="search-header">
        <h1>Minha Lista</h1>
      </div>
      <div class="grid-view" id="favorites-container">
        <!-- Favoritos ser√£o carregados via JavaScript -->
      </div>
    </div>
  </div>

  <div class="page" data-page="about">
    <div class="about-page">
      <div class="about-header">
        <h1>Sobre o NFLIX</h1>
      </div>
      <div class="about-content">
        <div class="about-section">
          <h2>Quem Somos</h2>
          <p>O NFLIX √© uma plataforma de streaming desenvolvida para oferecer uma experi√™ncia √∫nica de entretenimento. Nossa miss√£o √© proporcionar acesso a uma vasta biblioteca de filmes, s√©ries e animes de forma pr√°tica e acess√≠vel.</p>
        </div>
        
        <div class="about-section">
          <h2>Informa√ß√µes Importantes</h2>
          <p><strong>Aviso Legal:</strong> O NFLIX n√£o armazena nenhum conte√∫do em nossos servidores. Todo o conte√∫do √© obtido de fontes p√∫blicas dispon√≠veis na internet atrav√©s de APIs oficiais.</p>
          <p>N√£o somos respons√°veis pelo conte√∫do externo vinculado em nossa plataforma. Recomendamos que os usu√°rios verifiquem a legalidade do conte√∫do em sua regi√£o.</p>
        </div>
        
        <div class="about-section">
          <h2>Recursos</h2>
          <div class="about-features">
            <div class="feature-item">
              <i class="fas fa-film"></i>
              <h3>Filmes</h3>
              <p>Cat√°logo diversificado</p>
            </div>
            <div class="feature-item">
              <i class="fas fa-tv"></i>
              <h3>S√©ries</h3>
              <p>Conte√∫do epis√≥dico</p>
            </div>
            <div class="feature-item">
              <i class="fas fa-dragon"></i>
              <h3>Animes</h3>
              <p>Anima√ß√£o japonesa</p>
            </div>
            <div class="feature-item">
              <i class="fas fa-heart"></i>
              <h3>Favoritos</h3>
              <p>Salve seus preferidos</p>
            </div>
          </div>
        </div>
        
        <div class="about-section" style="text-align: center;">
          <h2>Baixe Nosso App</h2>
          <p>Tenha uma experi√™ncia ainda melhor com nosso aplicativo m√≥vel. Recursos otimizados, interface intuitiva e muito mais!</p>
          <a href="https://www.mediafire.com/file/q7cul1zz1lhytd2/Stream++Lite.apk/file" class="download-btn" target="_blank">
            <i class="fas fa-download"></i> Baixar App
          </a>
        </div>
        
        <div class="about-section">
          <h2>Contato</h2>
          <p>Para d√∫vidas, sugest√µes ou problemas t√©cnicos, entre em contato conosco atrav√©s dos nossos canais oficiais.</p>
          <p><strong>Desenvolvido com ‚ù§Ô∏è para amantes do entretenimento</strong></p>
        </div>
      </div>
    </div>
  </div>

  <div class="page" data-page="details">
    <div class="details-page">
      <div class="details-header" id="details-header"></div>
      <div class="details-poster-container">
        <img src="" alt="" class="details-poster" id="details-poster">
      </div>
      <div class="details-body">
        <h1 class="details-title" id="details-title"></h1>
        <div class="details-meta" id="details-meta"></div>
        <p class="details-overview" id="details-overview"></p>
        <div class="details-buttons">
          <button class="hero-btn btn-play" id="details-play">
            <i class="fas fa-play"></i> Assistir
          </button>
          <button class="hero-btn btn-info" id="details-favorite">
            <i class="fas fa-plus"></i> Minha Lista
          </button>
          <button class="hero-btn btn-info" id="details-share">
            <i class="fas fa-share-alt"></i> Compartilhar
          </button>
        </div>
        
        <h3 class="details-section-title">Elenco</h3>
        <div class="cast-container" id="cast-container"></div>
        
        <h3 class="details-section-title">Trailer</h3>
        <div class="trailer-container">
          <div class="trailer-placeholder" id="trailer-placeholder">
            Carregando trailer...
          </div>
          <iframe class="trailer-video" id="trailer-video" style="display: none;" 
                  allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                  allowfullscreen></iframe>
        </div>
        
        <h3 class="details-section-title">Recomenda√ß√µes</h3>
        <div class="carousel" id="recommendations-carousel"></div>
      </div>
    </div>
  </div>

  <!-- Player Modal Netflix -->
  <div class="player-modal" id="player-modal">
    <div class="player-modal-content">
      <div class="player-modal-close" id="player-modal-close">
        <i class="fas fa-times"></i>
      </div>
      
      <div class="player-container">
        <div class="player-loading" id="player-loading">
          <div class="spinner"></div>
          <p>Carregando player...</p>
        </div>
        <iframe class="video-player" id="video-player" allowfullscreen></iframe>
      </div>
    </div>
  </div>

  <!-- Bottom Navigation Netflix -->
  <div class="bottom-nav">
    <a href="?page=home" class="nav-item">
      <i class="fas fa-home"></i>
      <span>In√≠cio</span>
    </a>
    <a href="?page=search" class="nav-item">
      <i class="fas fa-search"></i>
      <span>Pesquisar</span>
    </a>
    <a href="?page=favorites" class="nav-item">
      <i class="fas fa-heart"></i>
      <span>Favoritos</span>
    </a>
    <a href="?page=about" class="nav-item">
      <i class="fas fa-info-circle"></i>
      <span>Sobre</span>
    </a>
  </div>

</script>
      // Configura√ß√µes
const API_BASE_URL = '/.netlify/functions/api';
const urlParams = new URLSearchParams(window.location.search);
const CURRENT_PAGE = urlParams.get('page') || 'home';
const MEDIA_ID = parseInt(urlParams.get('id') || '0', 10);
const MEDIA_TYPE = urlParams.get('type') || '';
const SEARCH_QUERY = urlParams.get('q') || '';
const APP_DOWNLOAD_LINK = '#';

// Elementos DOM
const heroSection = document.getElementById('hero');
const heroTitle = document.getElementById('hero-title');
const heroDesc = document.getElementById('hero-desc');
const heroPlayBtn = document.getElementById('hero-play');
const heroInfoBtn = document.getElementById('hero-info');
const categoriesContainer = document.getElementById('categories-container');
const searchResults = document.getElementById('search-results');
const searchInput = document.getElementById('search-input');
const headerSearchInput = document.getElementById('header-search-input');
const playerModal = document.getElementById('player-modal');
const playerModalClose = document.getElementById('player-modal-close');
const playerLoading = document.getElementById('player-loading');
const videoPlayer = document.getElementById('video-player');
const favoritesContainer = document.getElementById('favorites-container');
const trailerVideo = document.getElementById('trailer-video');
const trailerPlaceholder = document.getElementById('trailer-placeholder');
const pages = document.querySelectorAll('.page');
const bottomNavItems = document.querySelectorAll('.bottom-nav .nav-item');

// Estado da aplica√ß√£o
let currentMedia = {};
let currentPage = {
  search: 1
};
let totalPages = {
  search: 1
};
let categoryPages = {
  popular: 1,
  movies: 1,
  tv: 1,
  anime: 1
};

// Helpers
function setActivePage() {
  let matched = false;
  pages.forEach(page => {
    const isActive = page.dataset.page === CURRENT_PAGE;
    if (isActive) matched = true;
    page.classList.toggle('active', isActive);
    page.style.display = isActive ? 'block' : 'none';
  });

  if (!matched && pages[0]) {
    pages.forEach(page => {
      const isHome = page.dataset.page === 'home';
      page.classList.toggle('active', isHome);
      page.style.display = isHome ? 'block' : 'none';
    });
  }

  const activePage = matched ? CURRENT_PAGE : 'home';

  bottomNavItems.forEach(item => {
    const href = item.getAttribute('href') || '';
    const params = new URLSearchParams(href.split('?')[1] || '');
    const page = params.get('page') || 'home';
    item.classList.toggle('active', page === activePage);
  });
}

document.addEventListener('DOMContentLoaded', () => {
  setActivePage();
  
  // Event listeners para pesquisa no header
  headerSearchInput.addEventListener('keypress', (e) => {
    if (e.key === 'Enter') {
      const query = headerSearchInput.value.trim();
      if (query) {
        window.location.href = `?page=search&q=${encodeURIComponent(query)}`;
      }
    }
  });
  
  // Fechar player modal
  playerModalClose.addEventListener('click', closePlayerModal);
  
  // Carregar conte√∫do baseado na p√°gina atual
  switch(CURRENT_PAGE) {
    case 'home':
      loadHeroBanner();
      loadCategories();
      break;
    case 'search':
      setupSearch();
      break;
    case 'favorites':
      loadFavorites();
      break;
    case 'details':
      loadDetailsPage();
      break;
  }
  
  setupEventListeners();
});

// Configurar event listeners
function setupEventListeners() {
  // Bot√µes no hero
  if (heroPlayBtn) {
    heroPlayBtn.addEventListener('click', () => {
      if (currentMedia.id) openPlayer(currentMedia.id, currentMedia.media_type || 'movie');
    });
  }
  if (heroInfoBtn) {
    heroInfoBtn.addEventListener('click', () => {
      if (currentMedia.id) openDetailsPage(currentMedia.id, currentMedia.media_type || 'movie');
    });
  }
}

// Carregar banner principal
async function loadHeroBanner() {
  try {
    const url = `${API_BASE_URL}?api=hero`;
    const response = await fetch(url);
    const data = await response.json();
    
    if (data.error) {
      console.error('Erro no banner:', data.error);
      return;
    }
    
    // Escolher um item aleat√≥rio
    const randomIndex = Math.floor(Math.random() * data.results.length);
    const media = data.results[randomIndex];
    currentMedia = media;
    
    // Atualizar UI
    heroTitle.textContent = media.title || media.name;
    
    // Descri√ß√£o limitada a 150 caracteres
    let overview = media.overview || '';
    if (overview.length > 150) {
      overview = overview.substring(0, 150) + '...';
    }
    heroDesc.textContent = overview;
    
    // Definir imagem de fundo
    const backdropUrl = media.backdrop_path 
      ? `https://image.tmdb.org/t/p/original${media.backdrop_path}`
      : 'https://via.placeholder.com/1920x1080?text=NFLIX';
    
    heroSection.style.backgroundImage = `url(${backdropUrl})`;
    
    // Atualizar meta tags para SEO
    updateMetaTags(
      media.title || media.name,
      overview,
      backdropUrl
    );
    
  } catch (error) {
    console.error('Erro ao carregar banner:', error);
  }
}

// Atualizar meta tags para SEO
function updateMetaTags(title, description, image) {
  // Atualizar t√≠tulo
  document.title = `${title} - NFLIX`;
  
  // Atualizar meta description
  const metaDescription = document.querySelector('meta[name="description"]');
  if (metaDescription) {
    metaDescription.setAttribute('content', description);
  }
  
  // Atualizar meta og (Open Graph)
  let metaOgTitle = document.querySelector('meta[property="og:title"]');
  if (!metaOgTitle) {
    metaOgTitle = document.createElement('meta');
    metaOgTitle.setAttribute('property', 'og:title');
    document.head.appendChild(metaOgTitle);
  }
  metaOgTitle.setAttribute('content', title);
  
  let metaOgDescription = document.querySelector('meta[property="og:description"]');
  if (!metaOgDescription) {
    metaOgDescription = document.createElement('meta');
    metaOgDescription.setAttribute('property', 'og:description');
    document.head.appendChild(metaOgDescription);
  }
  metaOgDescription.setAttribute('content', description);
  
  let metaOgImage = document.querySelector('meta[property="og:image"]');
  if (!metaOgImage) {
    metaOgImage = document.createElement('meta');
    metaOgImage.setAttribute('property', 'og:image');
    document.head.appendChild(metaOgImage);
  }
  metaOgImage.setAttribute('content', image);
  
  let metaOgUrl = document.querySelector('meta[property="og:url"]');
  if (!metaOgUrl) {
    metaOgUrl = document.createElement('meta');
    metaOgUrl.setAttribute('property', 'og:url');
    document.head.appendChild(metaOgUrl);
  }
  metaOgUrl.setAttribute('content', window.location.href);
}

// Carregar categorias com pagina√ß√£o
async function loadCategories() {
  categoriesContainer.innerHTML = '';
  
  // Categorias pr√©-definidas
  const categories = [
    { 
      id: 'popular', 
      title: 'Populares', 
      apiType: 'hero',
      currentPage: categoryPages.popular
    },
    { 
      id: 'movies', 
      title: 'Filmes Populares', 
      apiType: 'movies',
      currentPage: categoryPages.movies
    },
    { 
      id: 'tv', 
      title: 'S√©ries Populares', 
      apiType: 'tv',
      currentPage: categoryPages.tv
    },
    { 
      id: 'anime', 
      title: 'Animes', 
      apiType: 'anime',
      currentPage: categoryPages.anime
    }
  ];
  
  // Carregar cada categoria
  for (const category of categories) {
    try {
      const response = await fetch(`${API_BASE_URL}?api=${category.apiType}&page=${category.currentPage}`);
      const data = await response.json();
      
      if (data.error) {
        console.error(`Erro na categoria ${category.title}:`, data.error);
        continue;
      }
      
      // Criar se√ß√£o da categoria com pagina√ß√£o
      const categoryHTML = `
        <div class="category" id="category-${category.id}">
          <h2 class="section-title">
            ${category.title}
            <span class="view-all" onclick="loadMoreCategory('${category.id}', '${category.apiType}', ${category.currentPage + 1})">
              Ver Mais
            </span>
          </h2>
          <div class="carousel" id="${category.id}">
            ${data.results.slice(0, 10).map(item => createMediaItem(item)).join('')}
          </div>
          <div class="category-pagination" id="pagination-${category.id}">
            ${createCategoryPagination(category.id, category.apiType, category.currentPage, data.total_pages)}
          </div>
        </div>
      `;
      
      categoriesContainer.innerHTML += categoryHTML;
    } catch (error) {
      console.error(`Erro ao carregar categoria ${category.title}:`, error);
    }
  }
  
  // Adicionar event listeners aos itens
  document.querySelectorAll('.item').forEach(item => {
    item.addEventListener('click', () => {
      const mediaId = item.dataset.id;
      const mediaType = item.dataset.type;
      openDetailsPage(mediaId, mediaType);
    });
  });
}

// Carregar mais itens de uma categoria
async function loadMoreCategory(categoryId, apiType, page) {
  try {
    const response = await fetch(`${API_BASE_URL}?api=${apiType}&page=${page}`);
    const data = await response.json();
    
    if (data.error) {
      console.error(`Erro ao carregar mais ${categoryId}:`, data.error);
      return;
    }
    
    // Atualizar p√°gina atual
    categoryPages[categoryId] = page;
    
    // Atualizar carrossel
    const carousel = document.getElementById(categoryId);
    carousel.innerHTML = data.results.slice(0, 10).map(item => createMediaItem(item)).join('');
    
    // Atualizar pagina√ß√£o
    const pagination = document.getElementById(`pagination-${categoryId}`);
    pagination.innerHTML = createCategoryPagination(categoryId, apiType, page, data.total_pages);
    
    // Re-adicionar event listeners
    document.querySelectorAll(`#${categoryId} .item`).forEach(item => {
      item.addEventListener('click', () => {
        const mediaId = item.dataset.id;
        const mediaType = item.dataset.type;
        openDetailsPage(mediaId, mediaType);
      });
    });
    
  } catch (error) {
    console.error(`Erro ao carregar mais ${categoryId}:`, error);
  }
}

// Criar pagina√ß√£o para categorias
function createCategoryPagination(categoryId, apiType, currentPage, totalPages) {
  // Limitar total de p√°ginas
  totalPages = Math.min(totalPages, 10);
  
  let paginationHTML = '';
  
  // Bot√£o anterior
  if (currentPage > 1) {
    paginationHTML += `
      <button class="category-pagination-btn" onclick="loadMoreCategory('${categoryId}', '${apiType}', ${currentPage - 1})">
        <i class="fas fa-chevron-left"></i>
      </button>
    `;
  } else {
    paginationHTML += `<button class="category-pagination-btn" disabled><i class="fas fa-chevron-left"></i></button>`;
  }
  
  // Informa√ß√£o da p√°gina atual
  paginationHTML += `<span class="category-pagination-info">P√°gina ${currentPage} de ${totalPages}</span>`;
  
  // Bot√£o pr√≥ximo
  if (currentPage < totalPages) {
    paginationHTML += `
      <button class="category-pagination-btn" onclick="loadMoreCategory('${categoryId}', '${apiType}', ${currentPage + 1})">
        <i class="fas fa-chevron-right"></i>
      </button>
    `;
  } else {
    paginationHTML += `<button class="category-pagination-btn" disabled><i class="fas fa-chevron-right"></i></button>`;
  }
  
  return paginationHTML;
}

// Carregar favoritos do localStorage
function loadFavorites() {
  try {
    const favorites = getFavorites();
    
    if (!favorites || favorites.length === 0) {
      favoritesContainer.innerHTML = '<p style="text-align: center; padding: 40px; color: #aaa;">Nenhum favorito encontrado</p>';
      return;
    }
    
    // Carregar detalhes de cada favorito
    Promise.all(
      favorites.map(async fav => {
        try {
          const url = `${API_BASE_URL}?api=details&id=${fav.id}&media_type=${fav.type}`;
          const response = await fetch(url);
          const data = await response.json();
          return {
            ...data,
            media_type: fav.type
          };
        } catch (error) {
          console.error('Erro ao carregar detalhes do favorito:', error);
          return null;
        }
      })
    ).then(favoritesWithDetails => {
      // Filtrar itens v√°lidos
      const validFavorites = favoritesWithDetails.filter(item => item !== null);
      
      if (validFavorites.length === 0) {
        favoritesContainer.innerHTML = '<p style="text-align: center; padding: 40px; color: #aaa;">Erro ao carregar favoritos</p>';
        return;
      }
      
      favoritesContainer.innerHTML = validFavorites.map(item => createGridItem(item)).join('');
      
      document.querySelectorAll('.grid-item').forEach(item => {
        item.addEventListener('click', () => {
          const mediaId = item.dataset.id;
          const mediaType = item.dataset.type;
          openDetailsPage(mediaId, mediaType);
        });
      });
    });
  } catch (error) {
    console.error('Erro ao carregar favoritos:', error);
    favoritesContainer.innerHTML = '<p style="text-align: center; padding: 40px; color: #aaa;">Erro ao carregar favoritos</p>';
  }
}

// Carregar p√°gina de detalhes
async function loadDetailsPage() {
  if (!MEDIA_ID || !MEDIA_TYPE) {
    window.location.href = '?page=home';
    return;
  }
  
  try {
    const url = `${API_BASE_URL}?api=details&id=${MEDIA_ID}&media_type=${MEDIA_TYPE}`;
    const response = await fetch(url);
    const data = await response.json();
    
    if (data.error) {
      console.error('Erro nos detalhes:', data.error);
      return;
    }
    
    currentMedia = data;
    currentMedia.media_type = MEDIA_TYPE;
    
    // Preencher informa√ß√µes da p√°gina
    const detailsTitle = document.getElementById('details-title');
    const detailsOverview = document.getElementById('details-overview');
    const detailsMeta = document.getElementById('details-meta');
    const detailsHeader = document.getElementById('details-header');
    const detailsPoster = document.getElementById('details-poster');
    
    detailsTitle.textContent = data.title || data.name;
    detailsOverview.textContent = data.overview || 'Descri√ß√£o n√£o dispon√≠vel.';
    
    // Atualizar meta tags para SEO
    updateMetaTags(
      data.title || data.name,
      data.overview || 'Assista agora no NFLIX',
      data.backdrop_path 
        ? `https://image.tmdb.org/t/p/original${data.backdrop_path}`
        : 'https://via.placeholder.com/1920x1080?text=NFLIX'
    );
    
    // Criar meta informa√ß√µes
    const releaseDate = data.release_date || data.first_air_date;
    const year = releaseDate ? releaseDate.split('-')[0] : 'N/A';
    
    let metaHTML = '';
    if (MEDIA_TYPE === 'movie') {
      const runtime = data.runtime ? 
        `${Math.floor(data.runtime / 60)}h ${data.runtime % 60}m` : 'N/A';
        
      metaHTML = `
        <span>${year}</span>
        <span>${runtime}</span>
        <span>‚≠ê ${data.vote_average ? data.vote_average.toFixed(1) : 'N/A'}</span>
      `;
    } else {
      const seasons = data.number_of_seasons ? `${data.number_of_seasons} temporada${data.number_of_seasons > 1 ? 's' : ''}` : 'N/A';
      metaHTML = `
        <span>${year}</span>
        <span>${seasons}</span>
        <span>‚≠ê ${data.vote_average ? data.vote_average.toFixed(1) : 'N/A'}</span>
      `;
    }
    
    detailsMeta.innerHTML = metaHTML;
    
    // Definir imagem de fundo do cabe√ßalho
    const backdropUrl = data.backdrop_path 
        ? `https://image.tmdb.org/t/p/original${data.backdrop_path}`
        : 'https://via.placeholder.com/1920x1080?text=NFLIX';
    
    detailsHeader.style.backgroundImage = `url(${backdropUrl})`;
    
    // Definir poster
    const posterUrl = data.poster_path 
        ? `https://image.tmdb.org/t/p/w500${data.poster_path}`
        : 'https://via.placeholder.com/500x750?text=Sem+Imagem';
    
    detailsPoster.src = posterUrl;
    
    // Verificar se √© favorito
    checkFavoriteStatus(data.id, MEDIA_TYPE);
    
    // Configurar bot√£o de play
    const detailsPlayBtn = document.getElementById('details-play');
    detailsPlayBtn.onclick = () => {
      openPlayer(data.id, MEDIA_TYPE);
    };
    
    // Configurar bot√£o de compartilhar
    const detailsShareBtn = document.getElementById('details-share');
    detailsShareBtn.onclick = () => {
      const url = new URL(window.location.href);
      
      if (navigator.share) {
        navigator.share({
          title: data.title || data.name,
          text: 'Confira este conte√∫do no NFLIX!',
          url: url.toString()
        })
        .catch(error => console.log('Erro ao compartilhar:', error));
      } else {
        navigator.clipboard.writeText(url.toString())
          .then(() => alert('Link copiado para a √°rea de transfer√™ncia!'))
          .catch(err => console.error('Erro ao copiar link:', err));
      }
    };
    
    // Buscar informa√ß√µes adicionais
    try {
      // Buscar cr√©ditos (elenco)
      const creditsUrl = `${API_BASE_URL}?api=credits&id=${MEDIA_ID}&media_type=${MEDIA_TYPE}`;
      const creditsResponse = await fetch(creditsUrl);
      const creditsData = await creditsResponse.json();
      if (!creditsData.error) {
        showCast(creditsData.cast.slice(0, 10)); // Mostrar os 10 primeiros
      }
      
      // Buscar trailer
      await loadTrailer(MEDIA_ID, MEDIA_TYPE);
      
      // Buscar recomenda√ß√µes
      const recommendationsUrl = `${API_BASE_URL}?api=recommendations&id=${MEDIA_ID}&media_type=${MEDIA_TYPE}`;
      const recommendationsResponse = await fetch(recommendationsUrl);
      const recommendationsData = await recommendationsResponse.json();
      if (!recommendationsData.error) {
        showRecommendations(recommendationsData.results.slice(0, 10)); // Mostrar 10 recomenda√ß√µes
      }
      
    } catch (error) {
      console.error('Erro ao carregar informa√ß√µes adicionais:', error);
    }
    
  } catch (error) {
    console.error('Erro ao carregar detalhes:', error);
  }
}

// Carregar trailer
async function loadTrailer(id, type) {
  try {
    const response = await fetch(`/.netlify/functions/api?api=videos&id=${id}&type=${type}`);
    const data = await response.json();
    
    if (data.error || !data.results || data.results.length === 0) {
      trailerPlaceholder.textContent = 'Trailer n√£o dispon√≠vel';
      return;
    }
    
    const youtubeVideos = data.results.filter(video => video.site === 'YouTube');
    const official = youtubeVideos.find(video => video.type === 'Trailer' || video.type === 'Teaser');
    const video = official || youtubeVideos[0];
    
    if (video) {
      // Mostrar trailer do YouTube
      trailerVideo.src = `https://www.youtube.com/embed/${video.key}?rel=0&showinfo=0&autoplay=0`;
      trailerVideo.style.display = 'block';
      trailerPlaceholder.style.display = 'none';
    } else {
      trailerPlaceholder.textContent = 'Trailer n√£o dispon√≠vel';
    }
    
  } catch (error) {
    console.error('Erro ao carregar trailer:', error);
    trailerPlaceholder.textContent = 'Erro ao carregar trailer';
  }
}

// Abrir p√°gina de detalhes
function openDetailsPage(id, type) {
  window.location.href = `?page=details&id=${id}&type=${type}`;
}

// Obter favoritos do localStorage
function getFavorites() {
  try {
    const favorites = localStorage.getItem('favorites');
    return favorites ? JSON.parse(favorites) : [];
  } catch (error) {
    console.error('Erro ao obter favoritos:', error);
    return [];
  }
}

// Salvar favoritos no localStorage
function saveFavorites(favorites) {
  try {
    localStorage.setItem('favorites', JSON.stringify(favorites));
    return true;
  } catch (error) {
    console.error('Erro ao salvar favoritos:', error);
    return false;
  }
}

// Verificar status de favorito
function checkFavoriteStatus(mediaId, mediaType) {
  const favorites = getFavorites();
  const isFavorite = favorites.some(fav => 
    fav.id == mediaId && fav.type === mediaType
  );
  
  const detailsFavoriteBtn = document.getElementById('details-favorite');
  if (!detailsFavoriteBtn) return;
  
  if (isFavorite) {
    detailsFavoriteBtn.innerHTML = '<i class="fas fa-check"></i> Na Minha Lista';
    detailsFavoriteBtn.onclick = () => removeFavorite(mediaId, mediaType);
  } else {
    detailsFavoriteBtn.innerHTML = '<i class="fas fa-plus"></i> Minha Lista';
    detailsFavoriteBtn.onclick = () => addFavorite(mediaId, mediaType);
  }
}

// Adicionar favorito
function addFavorite(mediaId, mediaType) {
  const favorites = getFavorites();
  const newFavorite = { id: mediaId, type: mediaType };
  
  // Verificar se j√° n√£o est√° na lista
  if (!favorites.some(fav => 
    fav.id == mediaId && fav.type === mediaType
  )) {
    favorites.push(newFavorite);
    saveFavorites(favorites);
    const detailsFavoriteBtn = document.getElementById('details-favorite');
    if (detailsFavoriteBtn) {
      detailsFavoriteBtn.innerHTML = '<i class="fas fa-check"></i> Na Minha Lista';
      detailsFavoriteBtn.onclick = () => removeFavorite(mediaId, mediaType);
    }
  }
}

// Remover favorito
function removeFavorite(mediaId, mediaType) {
  let favorites = getFavorites();
  favorites = favorites.filter(fav => 
    !(fav.id == mediaId && fav.type === mediaType)
  );
  saveFavorites(favorites);
  const detailsFavoriteBtn = document.getElementById('details-favorite');
  if (detailsFavoriteBtn) {
    detailsFavoriteBtn.innerHTML = '<i class="fas fa-plus"></i> Minha Lista';
    detailsFavoriteBtn.onclick = () => addFavorite(mediaId, mediaType);
  }
}

// Configurar busca
function setupSearch() {
  if (SEARCH_QUERY) {
    searchInput.value = SEARCH_QUERY;
    performSearch(SEARCH_QUERY);
  }
  
  // Pesquisa em tempo real
  let searchTimeout;
  searchInput.addEventListener('input', (e) => {
    clearTimeout(searchTimeout);
    const query = e.target.value.trim();
    if (query.length < 3) {
      searchResults.innerHTML = '';
      document.getElementById('search-pagination').innerHTML = '';
      return;
    }
    searchTimeout = setTimeout(() => {
      currentPage.search = 1;
      searchResults.innerHTML = '';
      performSearch(query);
    }, 500);
  });
}

// Realizar busca com pagina√ß√£o
async function performSearch(query, page = 1) {
  if (!query) {
    searchResults.innerHTML = '<p style="text-align: center; padding: 40px; color: #aaa;">Digite um termo de pesquisa</p>';
    return;
  }
  
  if (page === 1) {
    searchResults.innerHTML = '<p style="text-align: center; padding: 40px; color: #aaa;">Pesquisando...</p>';
  }
  
  try {
    currentPage.search = page;
    const url = `${API_BASE_URL}?api=search&query=${encodeURIComponent(query)}&page=${page}`;
    const response = await fetch(url);
    const data = await response.json();
    
    if (data.error) {
      console.error('Erro na pesquisa:', data.error);
      searchResults.innerHTML = '<p style="text-align: center; padding: 40px; color: #aaa;">Erro ao pesquisar</p>';
      return;
    }
    
    if (data.results.length === 0) {
      searchResults.innerHTML = '<p style="text-align: center; padding: 40px; color: #aaa;">Nenhum resultado encontrado</p>';
      return;
    }
    
    // Filtrar apenas filmes e s√©ries
    const filteredResults = data.results.filter(item => 
      item.media_type === 'movie' || item.media_type === 'tv'
    );
    
    if (filteredResults.length === 0) {
      searchResults.innerHTML = '<p style="text-align: center; padding: 40px; color: #aaa;">Nenhum resultado encontrado</p>';
      return;
    }
    
    // Atualizar total de p√°ginas
    totalPages.search = data.total_pages > 500 ? 500 : data.total_pages;
    
    searchResults.innerHTML = filteredResults.map(item => createGridItem(item)).join('');
    
    document.querySelectorAll('.grid-item').forEach(item => {
      item.addEventListener('click', () => {
        const mediaId = item.dataset.id;
        const mediaType = item.dataset.type;
        openDetailsPage(mediaId, mediaType);
      });
    });
    
    // Atualizar pagina√ß√£o
    updateSearchPagination(page, totalPages.search, query);
    
  } catch (error) {
    console.error('Erro na pesquisa:', error);
    searchResults.innerHTML = '<p style="text-align: center; padding: 40px; color: #aaa;">Erro ao pesquisar</p>';
  } finally {
    const loadingElement = document.getElementById('search-loading');
    if (loadingElement) loadingElement.style.display = 'none';
  }
}

// Atualizar pagina√ß√£o da busca
function updateSearchPagination(currentPage, totalPages, query) {
  const paginationElement = document.getElementById('search-pagination');
  if (!paginationElement) return;
  
  // Limitar total de p√°ginas para melhor performance
  totalPages = Math.min(totalPages, 500);
  
  let paginationHTML = '';
  
  // Bot√£o anterior
  if (currentPage > 1) {
    paginationHTML += `<button class="pagination-btn" onclick="performSearch('${query}', ${currentPage - 1})">Anterior</button>`;
  } else {
    paginationHTML += `<button class="pagination-btn" disabled>Anterior</button>`;
  }
  
  // Informa√ß√£o da p√°gina atual
  paginationHTML += `<span class="pagination-info">P√°gina ${currentPage} de ${totalPages}</span>`;
  
  // Bot√£o pr√≥ximo
  if (currentPage < totalPages) {
    paginationHTML += `<button class="pagination-btn" onclick="performSearch('${query}', ${currentPage + 1})">Pr√≥xima</button>`;
  } else {
    paginationHTML += `<button class="pagination-btn" disabled>Pr√≥xima</button>`;
  }
  
  paginationElement.innerHTML = paginationHTML;
}

// Abrir player (CORRIGIDO)
async function openPlayer(id, type) {
  try {
    // Mostrar loading no player
    playerLoading.style.display = 'flex';
    videoPlayer.style.display = 'none';
    playerModal.style.display = 'flex';
    document.body.style.overflow = 'hidden';
    
    console.log('Abrindo player para:', { id, type });
    
    // URL CORRETA para o player
    const response = await fetch(`/.netlify/functions/api?api=player&id=${id}&type=${type}`);
    const data = await response.json();
    
    if (data.error) {
      console.error('Erro ao obter URL do player:', data.error);
      playerLoading.innerHTML = `
        <div style="text-align: center;">
          <div class="spinner" style="border-top-color: #ff4444;"></div>
          <p>Erro ao carregar o player</p>
          <p style="font-size: 0.9rem; color: #ccc;">${data.error}</p>
          <button onclick="closePlayerModal()" style="margin-top: 20px; padding: 10px 20px; background: var(--primary-red); color: white; border: none; border-radius: 4px; cursor: pointer;">Fechar</button>
        </div>
      `;
      return;
    }
    
    console.log('Player URL recebida:', data.url);
    
    // Esconder loading e mostrar player
    videoPlayer.src = data.url;
    videoPlayer.style.display = 'block';
    playerLoading.style.display = 'none';
    
    // Event listeners para o player
    videoPlayer.addEventListener('load', () => {
      console.log('Player carregado com sucesso');
      playerLoading.style.display = 'none';
    });
    
    videoPlayer.addEventListener('error', (e) => {
      console.error('Erro no player:', e);
      playerLoading.innerHTML = `
        <div style="text-align: center;">
          <i class="fas fa-exclamation-triangle" style="font-size: 3rem; color: #ff4444; margin-bottom: 20px;"></i>
          <p>Conte√∫do n√£o dispon√≠vel</p>
          <p style="font-size: 0.9rem; color: #ccc;">Este conte√∫do pode n√£o estar dispon√≠vel no momento.</p>
          <button onclick="closePlayerModal()" style="margin-top: 20px; padding: 10px 20px; background: var(--primary-red); color: white; border: none; border-radius: 4px; cursor: pointer;">Fechar</button>
        </div>
      `;
      playerLoading.style.display = 'flex';
      videoPlayer.style.display = 'none';
    });
    
  } catch (error) {
    console.error('Erro ao abrir player:', error);
    playerLoading.innerHTML = `
      <div style="text-align: center;">
        <i class="fas fa-exclamation-triangle" style="font-size: 3rem; color: #ff4444; margin-bottom: 20px;"></i>
        <p>Erro ao carregar o player</p>
        <p style="font-size: 0.9rem; color: #ccc;">Tente novamente mais tarde.</p>
        <button onclick="closePlayerModal()" style="margin-top: 20px; padding: 10px 20px; background: var(--primary-red); color: white; border: none; border-radius: 4px; cursor: pointer;">Fechar</button>
      </div>
    `;
    playerLoading.style.display = 'flex';
  }
}

// Mostrar elenco
function showCast(cast) {
  const castContainer = document.getElementById('cast-container');
  if (!castContainer) return;
  
  if (cast.length === 0) {
    castContainer.innerHTML = '<p style="text-align: center; padding: 20px; color: #aaa;">Elenco n√£o dispon√≠vel</p>';
    return;
  }
  
  castContainer.innerHTML = cast.map(person => {
    const photoUrl = person.profile_path 
      ? `https://image.tmdb.org/t/p/w200${person.profile_path}`
      : 'https://via.placeholder.com/200x300?text=Sem+Imagem';
    
    return `
      <div class="cast-member">
        <img src="${photoUrl}" alt="${person.name}" class="cast-photo">
        <div class="cast-name">${person.name}</div>
        <div class="cast-character">${person.character}</div>
      </div>
    `;
  }).join('');
}

// Mostrar recomenda√ß√µes
function showRecommendations(recommendations) {
  const recommendationsCarousel = document.getElementById('recommendations-carousel');
  if (!recommendationsCarousel) return;
  
  if (recommendations.length === 0) {
    recommendationsCarousel.innerHTML = '<p style="text-align: center; padding: 20px; color: #aaa;">Nenhuma recomenda√ß√£o dispon√≠vel</p>';
    return;
  }
  
  recommendationsCarousel.innerHTML = recommendations.map(item => {
    const posterUrl = item.poster_path 
      ? `https://image.tmdb.org/t/p/w500${item.poster_path}`
      : 'https://via.placeholder.com/500x750?text=Sem+Imagem';
    
    const mediaType = item.title ? 'movie' : 'tv';
    
    return `
      <div class="item" data-id="${item.id}" data-type="${mediaType}">
        <img src="${posterUrl}" alt="${item.title || item.name}" class="item-poster" loading="lazy">
      </div>
    `;
  }).join('');
  
  // Adicionar event listeners aos itens de recomenda√ß√£o
  document.querySelectorAll('#recommendations-carousel .item').forEach(item => {
    item.addEventListener('click', () => {
      const mediaId = item.dataset.id;
      const mediaType = item.dataset.type;
      openDetailsPage(mediaId, mediaType);
    });
  });
}

// Criar item de m√≠dia para carrossel
function createMediaItem(item) {
  const title = item.title || item.name;
  let mediaType = item.media_type;
  
  if (!mediaType) {
    mediaType = item.title ? 'movie' : 'tv';
  }
  
  const posterUrl = item.poster_path 
    ? `https://image.tmdb.org/t/p/w500${item.poster_path}`
    : 'https://via.placeholder.com/500x750?text=Sem+Imagem';
  
  return `
    <div class="item" data-id="${item.id}" data-type="${mediaType}">
      <img src="${posterUrl}" alt="${title}" class="item-poster" loading="lazy">
    </div>
  `;
}

// Criar item de m√≠dia para grid
function createGridItem(item) {
  const title = item.title || item.name;
  let mediaType = item.media_type;
  
  if (!mediaType) {
    mediaType = item.title ? 'movie' : 'tv';
  }
  
  const posterUrl = item.poster_path 
    ? `https://image.tmdb.org/t/p/w500${item.poster_path}`
    : 'https://via.placeholder.com/500x750?text=Sem+Imagem';
  
  return `
    <div class="grid-item" data-id="${item.id}" data-type="${mediaType}">
      <img src="${posterUrl}" alt="${title}" class="grid-poster" loading="lazy">
      <div class="grid-title">${title}</div>
    </div>
  `;
}

// Fechar modal do player
function closePlayerModal() {
  playerModal.style.display = 'none';
  videoPlayer.src = '';
  document.body.style.overflow = 'auto';
}
  </script>
</body>
</html>